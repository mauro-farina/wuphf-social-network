<!DOCTYPE html>
<html>
    <head>
        <title>WUPHF.com</title>
        <meta charset="UTF-8">
        <meta name="description" content="WUPHF.com - The place to bark your thoughts">
        <meta name="keywords" content="wuphf, woof">
        <meta name="author" content="Mauro Farina">
        <meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Vue.js -->
		<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

		<!-- Bootstrap 5-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
        <!-- Bootstrap icons-->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
        <!-- Bootstrap JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>

        <link rel="stylesheet" href="./res/style.css">
    </head>
    
    <body data-bs-theme="dark"> <!-- DARK -->
        
          <main id="app" class="home-main text-bg-dark">

            <nav class="home-nav navbar navbar-expand-lg collapse-lg fixed-top">
                <div class="container-fluid">
                <!--<div class="container-fluid row flex-lg-column flex-md-row">-->

                    <div class="container-fluid" id="buttonTogglerContainer">
                    <!--<div class="container-fluid col" id="buttonTogglerContainer">-->
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                <!-- navbar-brand -->
                <!--
                    <div class="container col" id="nav-icon-container"> 
                        <a class="navbar-brand" href="/home">
                            <img src="./favicon.ico" class="nav-icon">
                        </a>
                    </div>
                -->
                <!--<div class="container-fluid collapse navbar-collapse col" id="navbarSupportedContent">-->
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <!--<ul class="nav-list navbar-nav me-auto mt-2" style="flex-direction:column">-->
                        <ul class="nav-list me-auto mt-2 font-xl" style="flex-direction:column">
                            <li class="nav-item" v-cloak>
                                <span class="nav-link font-xxl" v-if="user.authenticated">Hi, <a :href="'/api/social/users/'.concat(user.username)" class="local-primary-text link-no-underine">{{user.username}}</a></span>
                                <span class="nav-link" v-if="!user.authenticated">
                                    <a href="/" class="link-no-underine">Signup</a> or <a href="/login" class="link-no-underine">Login</a>
                                </span>
                            </li>
                            <li class="nav-item">
                                <a @click.prevent="goTo('feed')" class="nav-link">Feed</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" v-if="user.authenticated" @click.prevent="backToTop">New message</a>
                            </li>
                            <div class="input-group nav-item" v-cloak>
                                <input id="searchUserInput" class="form-control" v-model="usernameToLookup" @input.prevent="searchUser" placeholder="Search user" type="search" aria-label="Search">
                            <!--<button class="btn btn-success" @click.prevent="searchUser" type="submit" id="searchUserButton"><i class="bi bi-search"></i></button>-->
                            </div>

                        </ul>
                    </div>

                </div>
            </nav>

            <div id="top"></div>

            <section class="home-section row row-cols-1 text-start font-l">

                <!-- v-if="user.authenticated && currentView === 'feed'" -->
                <feed-container :user="user" :messages="messages" :current-path="currentPath"></feed-container>
                <!-- 
                    SHOUTOUT TO FARSAD FAKHIM https://stackoverflow.com/a/47559949
                -->

                <!-- v-if="!user.authenticated" -->
                <login-signup-message :user="user"></login-signup-message> 

                <!-- v-if="showSearch" -->
                <search-users-container :user="user" :username-to-lookup="usernameToLookup" :search-user-results="searchUserResults" :current-path="currentPath"></search-users-container>

                <user-profile-container :user="user" :current-path="currentPath" :show-profile-of="showProfileOf"></user-profile-container>
            </section>

        </main>

        <script type="module">
            import {methodsFunctions, getUserData} from './vueAppFunctions.js';
            import {FeedContainer, MessageContainer, MessageBody, LoginSignupMessage, SearchUsersContainer, UserProfileContainer} from './VueComponents.js';

            const { createApp } = Vue;
            const userData = await getUserData();
            /*
                Top level await is a feature available within modules. This means the await keyword can be used. 
                It allows modules to act as big asynchronous functions meaning code can be evaluated before use in parent modules, 
                but without blocking sibling modules from loading.
                https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules#top_level_await
            */

            const data = { 
                messages : userData.feed,
                user : userData.user,
                usernameToLookup : "",
                searchUserResults : [],
                currentPath : window.location.hash,
                showProfileOf : ""
            };

            const app = createApp({
                data() {
                    return data;
                },
                methods: {
                    backToTop : methodsFunctions.backToTop,
                    searchUser : methodsFunctions.searchUser,
                    goTo : methodsFunctions.goTo
                },
                mounted() {
                    window.addEventListener('hashchange', () => {
                        this.currentPath = window.location.hash; 
                        if(this.currentPath.includes('user/')) {
                            this.showProfileOf = this.currentPath.split('/')[1];
                        }
                    })
                }
            });

            app.component("FeedContainer", FeedContainer);
            app.component("MessageContainer", MessageContainer);
            app.component("MessageBody", MessageBody);
            app.component("LoginSignupMessage", LoginSignupMessage);
            app.component("SearchUsersContainer", SearchUsersContainer);
            app.component("UserProfileContainer", UserProfileContainer);

            app.mount("#app");
        </script>

    </body>

</html>